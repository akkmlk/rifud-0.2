{% extends 'layout/base_user.html' %}
{% block content %}

<section class="m-2">
    <div class="flex flex-col space-y-20 items-center ms-10 justify-center">
        <h1 class="text-primary font-bold" style="font-size: 38px;">
            Riwayat Transaksi
        </h1>
        
    </div>
    

    <div id="transactionList"  class="grid grid-cols-1 md:grid-cols-3 gap-20 m-10 ">
        
            

        
    </div>
    <script>
        async function fetchTransactionHistory(userId) {
            try {
                // Ambil data JSON dari endpoint asli
                const response = await fetch(`/api/transactions-history/${userId}`);
                const json = await response.json();

                if (json.status === 'success' && json.data) {
                renderTransactionHistory(json.data);
                } else {
                console.error("Gagal mengambil data transaksi:", json);
                document.getElementById('transactionList').innerHTML = '<p>Data tidak ditemukan.</p>';
                }
            } catch (error) {
                alert(error)
                console.error("Error fetching transaction history:", error);
                document.getElementById('transactionList').innerHTML = '<p>Terjadi kesalahan saat mengambil data.</p>';
            }
        }

        function renderTransactionHistory(transactions) {
            const listElement = document.getElementById('transactionList');
            listElement.innerHTML = '';

            if (!transactions || transactions.length === 0) {
                listElement.innerHTML = '<p>Tidak ada riwayat transaksi.</p>';
                return;
            }

            transactions.forEach(item => {
                const card = document.createElement('div');
                card.className = 'max-w-md mx-auto bg-white border-2 border-green-800 rounded-lg p-4 shadow-sm';

                card.innerHTML = `
                <!-- Header -->
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded flex items-center justify-center">
                        <img src="${item.foto_url_resto}" 
                            alt="gambar makanan" 
                            class="w-13 h-13 bg-cover rounded">
                    </div>
                    <div>
                        <h2 class="font-bold text-lg">${item.name || 'Nama Item'}</h2>
                        <p class="text-sm text-gray-600"> order #ORD-${item.id_transaction || '0'}</p> 
                        <p class="text-xs text-gray-500">${item.transaction_date || 'Tanggal tidak tersedia'}</p>
                    </div>
                    </div>
                    <span class="px-3 py-1 bg-primary text-yellow-400 rounded text-sm font-medium">
                    ${item.status || 'Tidak Diketahui'}
                    </span>
                </div>

                <!-- About Item -->
                <div class="mb-4">
                    <h3 class="font-bold text-md mb-1">${item.name || 'Nama Item'}</h3>
                    <p class="text-sm text-gray-700 leading-relaxed">
                    ${item.description || 'Deskripsi tidak tersedia'}
                    </p>
                </div>

                <!-- Image -->
                <img src="${item.foto_url_fw}" 
                    alt="gambar makanan" 
                    class="w-full h-30 bg-cover rounded mb-4">

                <!-- Total -->
                <div class="flex justify-between items-center mb-4">
                    <span class="font-bold text-lg">Total</span>
                    <span class="font-bold text-lg">Rp${item.price_total || '0'}</span>
                </div>
                `;

                listElement.appendChild(card);
            });
        }

        // Contoh: Ambil data untuk user dengan ID 9
        userId = sessionStorage.getItem('user_id')
        document.addEventListener("DOMContentLoaded", () => {
        fetchTransactionHistory(userId);
        });
    </script>
</section>
{% endblock %}